{% extends 'layouts/default.html' %}
{% block title %}Add Product - {{ APP_NAME }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="breadcrumb">
        <a href="{% url 'admin_products' %}">Products</a>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
        <span>Add Product</span>
    </div>
    <h1>
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Add New Product
    </h1>
</div>

<div class="card">
    <form method="POST" action="{% url 'admin_product_add' %}" enctype="multipart/form-data" class="product-form" id="product-form">
        {% csrf_token %}
        
        <div class="form-layout">
            <!-- Left Column - Main Info -->
            <div class="form-main">
                <div class="form-group">
                    <label for="name">Product Name <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required placeholder="Enter product name">
                </div>

                <div class="form-group">
                    <label for="description">Description <span class="required">*</span></label>
                    <textarea id="description" name="description" rows="5" required placeholder="Enter product description"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="price">Price ($) <span class="required">*</span></label>
                        <input type="number" id="price" name="price" step="0.01" min="0" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="stock">Stock Quantity <span class="required">*</span></label>
                        <input type="number" id="stock" name="stock" min="0" required placeholder="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="category">Category <span class="required">*</span></label>
                        <select id="category" name="category" required>
                            <option value="">Select a category</option>
                            {% for cat in categories %}
                            <option value="{{ cat }}">{{ cat }}</option>
                            {% endfor %}
                            <option value="__new__">+ Add New Category</option>
                        </select>
                    </div>
                    <div class="form-group" id="new-category-group" style="display: none;">
                        <label for="new_category">New Category Name</label>
                        <input type="text" id="new_category" name="new_category" placeholder="Enter new category">
                    </div>
                </div>

                <div class="form-group">
                    <label for="sku">SKU (Stock Keeping Unit)</label>
                    <input type="text" id="sku" name="sku" placeholder="e.g., PROD-001">
                </div>
            </div>

            <!-- Right Column - Image & Status -->
            <div class="form-sidebar">
                <div class="form-group">
                    <label>Product Image</label>
                    <div class="image-upload-area" id="image-upload-area">
                        <input type="file" id="image" name="image" accept="image/*" hidden>
                        <div class="upload-placeholder" id="upload-placeholder">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            <span>Click to upload image</span>
                            <small>PNG, JPG up to 5MB</small>
                        </div>
                        <img id="image-preview" class="image-preview" style="display: none;">
                    </div>
                    <div class="form-group" style="margin-top: 0.5rem;">
                        <label for="image_url">Or enter image URL</label>
                        <input type="url" id="image_url" name="image_url" placeholder="https://example.com/image.jpg">
                    </div>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="is_active" value="1" checked>
                        <span>Product is active</span>
                    </label>
                    <small class="form-hint">Inactive products won't be shown to customers</small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="is_featured" value="1">
                        <span>Featured product</span>
                    </label>
                    <small class="form-hint">Featured products appear on the homepage</small>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <a href="{% url 'admin_products' %}" class="btn">Cancel</a>
            <button type="submit" class="btn btn-primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Product
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Category selection - show new category field
    const categorySelect = document.getElementById('category');
    const newCategoryGroup = document.getElementById('new-category-group');
    const newCategoryInput = document.getElementById('new_category');

    categorySelect.addEventListener('change', function() {
        if (this.value === '__new__') {
            newCategoryGroup.style.display = 'block';
            newCategoryInput.required = true;
        } else {
            newCategoryGroup.style.display = 'none';
            newCategoryInput.required = false;
        }
    });

    // Image upload preview
    const imageInput = document.getElementById('image');
    const imagePreview = document.getElementById('image-preview');
    const uploadPlaceholder = document.getElementById('upload-placeholder');
    const uploadArea = document.getElementById('image-upload-area');

    uploadArea.addEventListener('click', () => imageInput.click());

    imageInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                uploadPlaceholder.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    });

    // Image URL preview
    const imageUrlInput = document.getElementById('image_url');
    imageUrlInput.addEventListener('change', function() {
        if (this.value) {
            imagePreview.src = this.value;
            imagePreview.style.display = 'block';
            uploadPlaceholder.style.display = 'none';
        }
    });

    // Drag and drop
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', function() {
        this.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('dragover');
        
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
            imageInput.files = e.dataTransfer.files;
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                uploadPlaceholder.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    });

    // Form submission
    const form = document.getElementById('product-form');
    form.addEventListener('submit', function(e) {
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-small"></span> Adding...';
    });
});
</script>
{% endblock %}
