<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'E-Commerce Order Processing System' %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" type="image/svg+xml" href="/images/logo.svg">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content combined">
                <div class="logo-section">
                    <img src="/images/logo.svg" alt="Logo" class="header-logo">
                    <div class="brand-text">
                        <h1>ShopPerl  </h1>
                          <span class="tagline">E-Commerce with a Perl‑sonality</span>
                    </div>
                </div>
                % if (is_logged_in()) {
                <button type="button" class="hamburger" id="hamburgerBtn" aria-label="Toggle menu" aria-expanded="false" aria-controls="siteNav">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <nav class="site-nav" id="siteNav">
                    <ul>
                <li>
                    <a href="/dashboard">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="/products">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                            <line x1="12" y1="22.08" x2="12" y2="12"/>
                        </svg>
                        Products
                    </a>
                </li>
                <li>
                    <a href="/orders">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                            <line x1="8" y1="10" x2="16" y2="10"/>
                            <line x1="8" y1="14" x2="16" y2="14"/>
                            <line x1="8" y1="18" x2="12" y2="18"/>
                        </svg>
                        Orders
                    </a>
                </li>
                % if (has_role('customer')) {
                <li>
                    <a href="/cart" class="cart-link">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"/>
                            <circle cx="20" cy="21" r="1"/>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                        </svg>
                        Cart
                        <span class="cart-badge"><%= get_cart_count() %></span>
                    </a>
                </li>
                <li>
                    <a href="/account">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Account
                    </a>
                </li>
                % } else {
                <li>
                    <a href="/customers">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        Customers
                    </a>
                </li>
                <li>
                    <a href="/reports">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </svg>
                        Reports
                    </a>
                </li>
                % }
                <li class="nav-right">
                    <a href="/logout" class="logout-link">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        Logout (<%= current_user()->{username} %>)
                    </a>
                </li>
                    </ul>
                </nav>
                % }
            </div>
        </div>
    </header>
    
    <div class="container main-content">
        % if (my $success = flash 'success') {
        <div class="alert alert-success"><%= $success %></div>
        % }
        % if (my $error = flash 'error') {
        <div class="alert alert-error"><%= $error %></div>
        % }
        
        <%= content %>
    </div>
    
    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-wave">
            <svg viewBox="0 0 1200 120" preserveAspectRatio="none">
                <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"></path>
            </svg>
        </div>
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <img src="/images/logo.svg" alt="ShopPerl Logo" class="footer-logo">
                    <h3>ShopPerl</h3>
                    <p>E‑Commerce with a Perl‑sonality — your friendly order processing and inventory partner.</p>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="/dashboard">Dashboard</a></li>
                        <li><a href="/products">Products</a></li>
                        <li><a href="/orders">Orders</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Documentation</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Get in Touch</h4>
                    <div class="contact-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                        support@shopperl.com
                    </div>
                    <div class="contact-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72"/>
                        </svg>
                        +1 (555) 123-4567
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ShopPerl. Crafted with 
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="#dc3545" stroke="none">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                    for amazing shopping experiences.
                </p>
            </div>
        </div>
    </footer>
    
    <script>
    function toggleDropdown(event, id) {
        event.stopPropagation();
        const dropdown = document.getElementById(id);
        const allDropdowns = document.querySelectorAll('.dropdown-menu');
        
        // Close all other dropdowns
        allDropdowns.forEach(menu => {
            if (menu.id !== id) {
                menu.classList.remove('show');
                menu.classList.remove('show-upward');
            }
        });
        
        // Toggle current dropdown
        const isShowing = dropdown.classList.contains('show');
        dropdown.classList.toggle('show');
        
        // Check if dropdown should show upward (if too close to bottom)
        if (!isShowing) {
            const rect = dropdown.getBoundingClientRect();
            const dropdownHeight = dropdown.offsetHeight || 150; // estimated height
            const viewportHeight = window.innerHeight;
            const spaceBelow = viewportHeight - rect.top;
            
            // If not enough space below, show upward
            if (spaceBelow < dropdownHeight + 20) {
                dropdown.classList.add('show-upward');
            } else {
                dropdown.classList.remove('show-upward');
            }
        }
    }
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function() {
        const allDropdowns = document.querySelectorAll('.dropdown-menu');
        allDropdowns.forEach(menu => {
            menu.classList.remove('show');
            menu.classList.remove('show-upward');
        });
    });

    // Sticky header: apply class when scrolling down
    (function() {
        const header = document.querySelector('header');
        if (!header) return;
        let lastScroll = 0;
        window.addEventListener('scroll', function() {
            const sc = window.scrollY || window.pageYOffset;
            if (sc > 12) {
                header.classList.add('sticky');
            } else {
                header.classList.remove('sticky');
            }
            lastScroll = sc;
        }, { passive: true });
    })();
    
    // Mobile menu toggle
    (function() {
        const btn = document.getElementById('hamburgerBtn');
        const nav = document.getElementById('siteNav');
        if (!btn || !nav) return;

        function closeNav() {
            if (nav.classList.contains('open')) {
                nav.classList.remove('open');
                btn.setAttribute('aria-expanded', 'false');
                // ensure hidden when closed
                nav.style.display = 'none';
            }
        }

        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            const isOpen = nav.classList.toggle('open');
            btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            // also set inline display for increased reliability across browsers
            if (isOpen) {
                nav.style.display = 'block';
            } else {
                nav.style.display = 'none';
            }
        });

        // Close when clicking outside
        document.addEventListener('click', function(e) {
            if (!nav.contains(e.target) && !btn.contains(e.target)) {
                closeNav();
            }
        });

        // Close on resize when switching to desktop
        window.addEventListener('resize', function() {
            if (window.innerWidth > 880) {
                closeNav();
            }
        });
    })();
    </script>
</body>
</html>
